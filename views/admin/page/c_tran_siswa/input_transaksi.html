<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" type="image/png" sizes="16x16" href="<?=base_url();?>assets/plugins/images/favicon.png">
    <title>Aplikasi Bayaran Sekolah Ashabul Yamin</title>
    <!-- Bootstrap Core CSS -->
    <link href="<?=base_url();?>assets/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Menu CSS -->
    <link href="<?=base_url();?>assets/plugins/bower_components/sidebar-nav/dist/sidebar-nav.min.css" rel="stylesheet">
    <!-- animation CSS -->
    <link href="<?=base_url();?>assets/css/animate.css" rel="stylesheet">
    <!-- data table-->
    <link href="<?=base_url();?>assets/plugins/bower_components/datatables/jquery.dataTables.min.css" rel="stylesheet" type="text/css" />
    <!-- Custom CSS -->
    <link href="<?=base_url();?>assets/css/style.css" rel="stylesheet">
    <!-- data table -->
    <script src="<?=base_url();?>assets/plugins/bower_components/datatables/jquery.dataTables.min.js"></script>
    <!-- color CSS -->
    <link href="<?=base_url();?>assets/css/colors/blue.css" id="theme" rel="stylesheet">

    <!-- Date picker plugins css -->
    <link href="<?=base_url();?>assets/plugins/bower_components/bootstrap-datepicker/bootstrap-datepicker.min.css" rel="stylesheet" type="text/css" />
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.<?=base_url();?>assets/js/1.4.2/respond.min.js"></script>

<![endif]-->
    <style>
        .dataTables_wrapper {
            min-height: 500px
        }

        .dataTables_processing {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            margin-left: -50%;
            margin-top: -25px;
            padding-top: 20px;
            text-align: center;
            font-size: 1.2em;
            color:grey;
        }
    </style>

</head>

<body class="fix-header">
    <!-- ============================================================== -->
    <!-- Preloader -->
    <!-- ============================================================== -->
    <div class="preloader">
        <svg class="circular" viewBox="25 25 50 50">
            <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10" />
        </svg>
    </div>
    <!-- ============================================================== -->
    <!-- Wrapper -->
    <!-- ============================================================== -->
    <div id="wrapper">
        <!-- ============================================================== -->
        <!-- Topbar header - style you can find in pages.scss -->

        <?php $this->load->view('admin/topbar.html'); ?>

        <!-- End Top Navigation -->
        <!-- ============================================================== -->
        <!-- Left Sidebar - style you can find in sidebar.scss  -->

        <?php $this->load->view('admin/sidebar.html'); ?>

        <!-- ============================================================== -->
        <!-- End Left Sidebar -->
        <!-- ============================================================== -->
        <!-- ============================================================== -->
        <!-- Page Content -->
        <!-- ============================================================== -->
        <div id="page-wrapper">
            <div class="container-fluid">
              <div class="row bg-title">
                  <div class="col-lg-3 col-md-4 col-sm-4 col-xs-12">
                      <h4 class="page-title">Input Transaksi</h4> </div>
                        <div class="col-lg-9 col-sm-8 col-md-8 col-xs-12">
                            <ol class="breadcrumb">
                                <li><a href="<?=base_url();?>">Dashboard</a></li>
                                <li><a href="<?=base_url();?>3-bayaran">Transaksi Pembayaran</a></li>
                                <li class="active">Input</li>
                            </ol>
                        </div>
                        <!-- /.col-lg-12 -->
                    </div>

                    <div class="row">
                      <form action="<?=base_url();?>C_tran_siswa/simpan_bayar/" id="data_table" method="post">
                      <div class="col-md-4 col-lg-4">
                          <div class="panel panel-default">
                             <div class="panel-heading">
                               Informasi Siswa
                             </div>
                             <div class="panel-wrapper collapse in">
                               <div class="panel-body">
                                 <table border="0" cellpadding="0" cellspacing="0" style="width: 100%;">
                                    <tbody>
                                      <tr>
                                        <td><strong>NIK Siswa</strong>
                                          <p style="margin-top:10px;"><?=$detail->kode_siswa;?></p></td>
                                      </tr>
                                      <tr>
                                        <td><strong>Nama Lengkap</strong>
                                          <p style="margin-top:10px;"><?=$detail->nama_siswa;?></p></td>
                                      </tr>
                                      <tr>
                                        <td><strong>Tahun Ajaran</strong>
                                          <p style="margin-top:10px;"><?=$detail->nama_ajaran;?></p></td>
                                      </tr>
                                      <tr>
                                        <td><strong>Kelas</strong>
                                          <p style="margin-top:10px;"><?=$detail->nama_kelas;?></p></td>
                                      </tr>
                                    </tbody>
                                  </table>
                               </div>
                               </div>
                               <div class="panel-footer">
                                 <!-- <a href="#" data-toggle="modal" data-target="#modalTambah" data-backdrop="static" data-keyboard="false" class="btn btn-success waves-effect waves-light">Tambah Transaksi</a> -->
                               </div>
                             </div>
                          </div>

                          <div class="col-md-8 col-lg-8">
                            <div class="panel panel-default">
                               <div class="panel-heading">
                                 <div class="row">
                                   <div class="col-lg-4 col-md-4">
                                     Bayaran
                                   </div>
                                   <div class="col-lg-8 col-md-8">
                                     <div class="text-right" id="get_no_bayar">
                                         <input type="hidden" name="no_pembayaran" id="no_pembayaran" value="<?=$no_pembayaran?>" />
                                         <p><strong>No. Pembayaran : <?=$no_pembayaran?></strong></p>
                                     </div>
                                   </div>
                                 </div>

                                 <input type="hidden" name="id_tran" value="<?=$id_tran;?>"/>
                                 <input type="hidden" name="periode" value="<?=$periode;?>"/>
                                 <input type="hidden" name="kode_periode" value="<?=$kode_periode;?>"/>
                                 <input type="hidden" name="id_siswa" value="<?=$detail->id_siswa;?>"/>
                                 <input type="hidden" name="id_tahun_ajaran" value="<?=$detail->id_ajaran;?>"/>
                                 <input type="hidden" name="id_kelas" value="<?=$detail->id_kelas;?>"/>

                               </div>
                               <div class="panel-body">
                                 <div class="row">
                                   <div class="col-lg-12 col-md-12">
                                     <?php
                                      if(!empty($list_bulanan))
                                      {
                                        $no=0;
                                        $total_tagihan = 0;
                                        $total_sudah = 0;
                                        $sisa_bayar = 0;
                                        $jumlah_bayar = 0;
                                     ?>

                                     <table class="table table-bordered table-striped" id="mytable">
                                        <thead>
                                        <tr>
                                         <th width="80px">#</th>
                                         <th width="25%">Nama Bayaran</th>
                                         <th width="15%">Periode</th>
                                         <th width="20%">Tagihan</th>
                                         <th width="20%">Sudah Bayar</th>
                                         <th width="20%">Sisa</th>
                                         <th width="20%">Jumlah Bayar</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                          <?php
                                            foreach($list_bulanan as $row)
                                            {

                                          ?>

                                          <tr>
                                            <td><input type="hidden" name="id_d_tran[<?=$no;?>]" id="id_d_tran" value="<?=$row->id_d_tran;?>" /><?=$no+1;?></td>
                                            <td><input type="hidden" name="id_bayaran[<?=$no;?>]" id="id_bayaran" value="<?=$row->id_bayaran;?>" /><?=$row->nama_bayaran;?></td>
                                            <td><?=$periode;?></td>
                                            <td class="text-right"><?=number_format($row->nominal);?></td>
                                            <td class="text-right"><?=number_format($row->bayar);?></td>
                                            <td class="text-right"><?=number_format($row->sisa_bayar);?></td>
                                            <td><input type="number" min="0" <?php if($row->sisa_bayar <= 0) { echo 'disabled'; }?>
                                                 onchange="setBayar(<?=$no;?>)" name="input_bayar[<?=$no;?>]" id="input_bayar_<?=$no;?>"
                                                 value="<?=$row->input_bayar;?>" /></td>
                                            <!-- _<?=$no;?> -->
                                          </tr>
                                          <?php
                                              $total_tagihan += $row->nominal;
                                              $total_sudah += $row->bayar;
                                              $sisa_bayar += $row->sisa_bayar;
                                              $jumlah_bayar += $row->input_bayar;
                                              $no++;

                                            }
                                           ?>
                                           <tr>
                                             <td></td>
                                             <td></td>
                                             <td></td>
                                             <td class="text-right"><strong><?=number_format($total_tagihan);?></strong></td>
                                             <td class="text-right"><strong><?=number_format($total_sudah);?></strong></td>
                                             <td class="text-right"><strong><?=number_format($sisa_bayar);?></strong></td>
                                             <td class="text-right"><strong id="input_jumlah_bayar"><?=number_format($jumlah_bayar);?></strong></td>
                                           </tr>
                                        </tbody>
                                    </table>
                                          <input type="hidden" name="count_data" id="count_data" value="<?=$no;?>" />
                                    <?php } ?>
                                  </div>
                                  <div class="col-lg-12 col-md-12">
                                    <div class="pull-right m-t-30 text-right">
                                      <h4>Total Tagihan : Rp. <?=number_format($total_tagihan);?></h4>
                                      <input type="hidden" name="biaya_pengurang" id="biaya_pengurang" value="<?=$biaya_pengurang;?>" />
                                      <p>Potongan Biaya : Rp. <?=number_format($biaya_pengurang);?></p>

                                      <?php if($biaya_pengurang > 0) { ?>
                                        <hr>
                                        <p><b>Tagihan Setelah Potongan: Rp. <?=number_format($total_tagihan-$biaya_pengurang);?></b></p>
                                      <?php } ?>

                                      <p>Sudah Bayar : Rp. <?=number_format($total_sudah);?></p>
                                      <hr>
                                      <h4><b>Sisa Pembayaran : Rp. <?=number_format(($total_tagihan-$biaya_pengurang) - $total_sudah);?></b></h4>
                                      <h4><b>Jumlah Bayar : Rp. <span id="jumlah_bayar"><?=number_format($jumlah_bayar);?></span></b></h4>
                                      <input type="hidden" name="jumlah_bayar" value="<?=$jumlah_bayar;?>" />
                                      <input type="hidden" name="sisa_bayar" id="sisa_bayar" value="<?=($total_tagihan-$biaya_pengurang) - $total_sudah;?>" />
                                      <hr>
                                    </div>
                                  </div>
                                  <div class="col-md-12">
                                    <div class="form-group">
                                      <textarea name="keterangan" id="keterangan" placeholder="Keterangan" class="form-control" rows="2"><?=$keterangan;?></textarea>
                                    </div>
                                  </div>
                                  <div class="col-md-12">
                                    <div id="alert_info"></div>
                                  </div>
                                  </div>
                                </div>
                                <div class="modal-footer">
                                  <div class="row">
                                    <div class="col-lg-6 col-md-6">
                                      <div class="text-left">

                                        <div class="form-group row">
                                             <div class="col-sm-3">
                                               <label for="date">Tanggal Bayar</label>
                                             </div>
                                             <div class="input-group col-sm-5 col-sm-offset-3">
                                                <input type="text" name="tgl_bayar" class="form-control" value="<?php echo $tgl; ?>" id="datepicker-autoclose" placeholder="yyyy/mm/dd"> <span class="input-group-addon"><i class="icon-calender"></i></span>
                                             </div>

                                         </div>
                                      </div>
                                    </div>
                                    <div class="col-lg-6 col-md-6">
                                      <button class="btn btn-info" <?php if($jumlah_bayar == 0) { echo 'disabled'; } ?> id="btn_bayar" onclick="return confirm('Apakah anda yakin?')" type="submit"> Proses Pembayaran </button>
                                      <a href="<?=base_url();?>detail-bayaran/<?=$detail->id_siswa?>" class="btn btn-danger waves-effect text-left">Batal</a>
                                    </div>
                                  </div>
                                </div>



                               </div>
                             </div>
                           </form>
                          </div>


                      </div>
                        <div class="row">

                        </div>
                      </div>

                    </div>

                <!-- ============================================================== -->
            </div>
            <!-- /.container-fluid -->
            <footer class="footer text-center"> 2019 &copy; Ashabul Yamin </footer>
        </div>
        <!-- ============================================================== -->
        <!-- End Page Content -->
        <!-- ============================================================== -->





    </div>
    <!-- /#wrapper -->





    <!-- jQuery -->
    <script src="<?=base_url();?>assets/plugins/bower_components/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap Core JavaScript -->
    <script src="<?=base_url();?>assets/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- Menu Plugin JavaScript -->
    <script src="<?=base_url();?>assets/plugins/bower_components/sidebar-nav/dist/sidebar-nav.min.js"></script>
    <!--slimscroll JavaScript -->
    <script src="<?=base_url();?>assets/js/jquery.slimscroll.js"></script>
    <!--Wave Effects -->
    <script src="<?=base_url();?>assets/js/waves.js"></script>
    <!-- data table -->
    <script src="<?=base_url();?>assets/plugins/bower_components/datatables/jquery.dataTables.min.js"></script>
    <!-- Custom Theme JavaScript -->
    <script src="<?=base_url();?>assets/js/custom.min.js"></script>
    <!--Style Switcher -->
    <script src="<?=base_url();?>assets/plugins/bower_components/styleswitcher/jQuery.style.switcher.js"></script>

    <!-- Date Picker Plugin JavaScript -->
    <script src="<?=base_url();?>assets/plugins/bower_components/bootstrap-datepicker/bootstrap-datepicker.min.js"></script>

    <script type="text/javascript">
      function setBayar(id)
      {
        var count = document.getElementById("count_data").value;
        var sisa_bayar = document.getElementById("sisa_bayar").value;
        //var input = $('#input_bayar_'+id).val();
        console.log('')
        var myControls = [];
        var bayar = 0;
        for (var i = 0; i < count; i++) {
          var sub = $('#input_bayar_'+i).val();
          if(sub == '') sub = 0;
          bayar += parseFloat(sub);
        }
        //alert(sisa_bayar);

        $('#jumlah_bayar').html(bayar.toLocaleString());
        $('#input_jumlah_bayar').html(bayar.toLocaleString());

        $('input[name=jumlah_bayar]').val(bayar);

        if(bayar > sisa_bayar)
        {
          $("#btn_bayar").attr("disabled", true);
          $('#alert_info').html('<div class="alert alert-danger">Jumlah bayar melebihi sisa pembayaran!</div>');
        } else if(bayar == 0) {
          $("#btn_bayar").attr("disabled", true);
          $('#alert_info').html('');
        } else {
          $("#btn_bayar").attr("disabled", false);
          $('#alert_info').html('');
        }



      }
    </script>

    <script>

    // Date Picker
    jQuery('.mydatepicker, #datepicker').datepicker();
    jQuery('#datepicker-autoclose').datepicker({
        autoclose: true,
        todayHighlight: true,
        format: 'yyyy-mm-dd'
    });

    jQuery('#datepicker-autoclose2').datepicker({
        autoclose: true,
        todayHighlight: true,
        format: 'yyyy-mm-dd'
    });
    jQuery('#date-range').datepicker({
        toggleActive: true,
        format: 'yyyy-mm-dd'
    });

    </script>
</body>

</html>
